function Rectangle(e,t,n,r){this.x=e;this.y=t;this.width=n;this.height=r;this.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"};this.rectContainsPoint=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height};this.intersects=function(e){return this.x<=e.x+e.width&&e.x<=this.x+this.width&&this.y<=e.y+e.height&&e.y<=this.y+this.height};this.intersection=function(e){var t=Math.max(this.x,e.x);var n=Math.min(this.x+this.width,e.x+e.width);if(t<=n){var r=Math.max(this.y,e.y);var i=Math.min(this.y+this.height,e.y+e.height);if(r<=i){return new Rectangle(t,r,n-t,i-r)}}return null}}(function(e){function t(t){var n=e(t).is("img");if(!n&&!e(t).is("canvas"))return null;var r=n?document.createElement("canvas"):t;if(!r.getContext)return null;var i;if(n){r.setAttribute("width",e(t).outerWidth());r.setAttribute("height",e(t).outerHeight());i=r.getContext("2d");i.drawImage(t,0,0,e(t).outerWidth(),e(t).outerHeight())}return r}e.fn.getRect=function(){var e=this.offset();if(!e)return null;var t=e.left;var n=e.top;return new Rectangle(t,n,this.outerWidth(),this.outerHeight())};e.fn.hitTestPoint=function(n){var r=e.extend({x:0,y:0,transparency:false},n);var i=this.getRect();var s=i.rectContainsPoint(r.x,r.y);var o=this[0];if(!r.transparency||!e(o).is("img")&&!e(o).is("canvas"))return s;if(!s)return false;var u=t(o);if(u==null)return true;var a=u.getContext("2d");var f=a.getImageData(r.x-i.x,r.y-i.y,1,1);return f.data[3]!=0};e.fn.objectHitTest=function(n){var r=e.extend({object:null,transparency:false},n);if(r.object==null)return false;var i=this.getRect();var s=r.object.getRect();var o=i.intersects(s);var u=this[0];if(!r.transparency||!e(u).is("img")&&!e(u).is("canvas"))return o;if(!o)return false;var a=t(u);var f=t(r.object[0]);if(a==null||f==null)return true;var l=a.getContext("2d");var c=f.getContext("2d");var h=i.intersection(s);if(!h)return true;var p=l.getImageData(h.x-i.x,h.y-i.y,h.width>0?h.width:1,h.height>0?h.height:1);var d=c.getImageData(h.x-s.x,h.y-s.y,h.width>0?h.width:1,h.height>0?h.height:1);var v=p.data;var m=d.data;var g=p.width*p.height*4;for(var y=0;y<g;y+=4){if(v[y+3]!=0&&m[y+3]!=0)return true}return false}})(jQuery)

$.fn.FlappyBird=function(e){function g(e){ypos=Math.floor(Math.random()*-s)+0;$('<div class="flappy-column-container"></div>').appendTo(".flappy-columns").height(n.height()+s).css("margin-left",e);indexs=$(".flappy-column-container:last").index();$(".flappy-column-container").eq(indexs).append('<div class="flappy-up-column"></div><div class="flappy-down-column"></div>');$(".flappy-column-container").eq(indexs).css("top",ypos);$(".flappy-up-column, .flappy-down-column").height(n.height()/2)}function y(e){$(".flappy-columns").remove();$('<div class="flappy-columns"></div>').appendTo(n);$(".flappy-columns").css("left",n.width());for(var t=0;t<e;t++){xpos=i*t;g(xpos)}}function b(){n.children().remove();$('<span class="flappy-counts">0</span><div class="flappy"><div class="flappy-animation"></div></div><div class="flappy-line"></div>').appendTo(n);$(".flappy-animation").css("background-image","url(http://troevkube.ru/flappy/flappy-assets/image/"+a+".gif)");$(".flappy-line").width(n.width());y(r)}function w(e){e-e-1;$(".flappy-columns").animate({left:-(e+40)*400},(e+40)*1680,"linear",function(){C()})}function E(){currentS=$(".flappy").css("top");currentS=parseFloat(currentS);bottomCollision=$(window).innerHeight()-($(".flappy").height()+$(".flappy-line").height());if(currentS>=bottomCollision){C()}}function S(){$(".flappy").on("testEvent",function(e){var t=$(this);var n=[];var s=[];var o=r*2;var u=$(".flappy").offset().left+$(".flappy").width()/2;var a=i*2;for(var f=0;f<o;f++){if(f<r-1){n.push($(".flappy-column-container").eq(f).children(".flappy-up-column"));n.push($(".flappy-column-container").eq(f).children(".flappy-down-column"));s.push($(".flappy-column-container").eq(f));Hitcounts=t.objectHitTest({object:s[f]});if(Hitcounts){if($(".flappy-columns").offset().left<=u){m=Math.abs(parseInt(($(".flappy-columns").offset().left-a)/i));m=Math.round(m);$(".flappy-counts").text(m)}}}hit=t.objectHitTest({object:n[f]});if(hit&&p){p=false;C()}}if($(".flappy-column-container").first().offset().left<-$(".flappy-column-container").width()){$(".flappy-column-container").eq(0).remove();lastLeft=$(".flappy-column-container").last().css("margin-left");lastLeft=parseInt(lastLeft)+i;g(lastLeft)}})}function x(){clearInterval(d);mills=20;p=true;S();d=setInterval(function(){$(".flappy").trigger("testEvent")},mills)}function T(){v=$(".flappy").offset().top+($(".flappy").height()+$(".flappy-line").height());return v}function N(){b();$("*").stop();$('<div class="flappy-play"><div class="flappy-back-main"><div class="flappy-text"><h2>Flappy Bird</h2></div><div class="flappy-PleaseClick"></div></div></div>').insertAfter(n);$(".flappy-play").fadeOut(0,function(){$(this).fadeIn(200)});$(".flappy-play").width(n.width()).height(n.height());$(".flappy-play").attr("tabindex","0").focus();$(".flappy-line, .flappy").css("animation-play-state","running");$(".flappy").css("top",c);$(".flappy-play").bind("keydown",function(e){if(e.keyCode==38||e.keyCode==87||e.keyCode==32){k();$(this).fadeOut(150,function(){$(this).remove()});n.attr("tabindex","0").focus()}});$(".flappy-play").click(function(){k();$(this).fadeOut(150,function(){$(this).remove()})})}function C(){$("*").stop();FinalResult=parseInt($(".flappy-counts").text());if(isNaN(FinalResult)){FinalResult=0}o.push(FinalResult);max=Math.max.apply(null,o);$(".flappy-counts, .flappy-play").fadeOut(200);if(FinalResult<10){medal="medal-no"}else if(FinalResult>=10&&FinalResult<30){medal="medal-silver"}else if(FinalResult>=30&&FinalResult<50){medal="medal-bronze"}else if(FinalResult>=50&&FinalResult<75){medal="medal-gold"}else if(FinalResult>=75){medal="medal-ultimate"}animationspeed=(h-v)*2;$(".flappy").animate({top:n.height()-($(".flappy").height()+$(".flappy-line").height())},animationspeed,"linear",function(){$(".flappy-animation").css("background-image","url(http://troevkube.ru/flappy/flappy-assets/image/"+a+"-dead.png)")});n.unbind("click, mousedown, mouseup, keydown");$('<div class="flappy-play"><div class="flappy-back-result"><div class="flappy-result-text"><h1>Game Over</h1></div><div class="flappy-result-Back"><div class=flappy-result-Medal><p>Medal</p><img src=http://troevkube.ru/flappy/flappy-assets/image/'+medal+'.png alt="Medal" /></div><div class=flappy-results><p>score</p><h2>'+FinalResult+'</h2><p class="flappy-best-result">best</p><h2>'+max+'</h2></div></div><div class="flappy-buttons"><div class="flappy-restart"></div><a href="http://troevkube.ru/flappy/" class="flappy-rate"><div></div></a></div></div></div>').insertAfter(n);$(".flappy-play").width(n.width()).height(n.height()).css("cursor","default");$(".flappy-play").addClass("flappy-flash").delay(100).queue(function(){$(this).removeClass("flappy-flash").dequeue()});$(".flappy-result-text, .flappy-result-Back, .flappy-buttons ").css("opacity",0);$(".flappy-result-text").css("margin-top","-40px").animate({opacity:1,marginTop:"0px"},200,"linear");$(".flappy-result-Back").css("margin-top","60px").delay(200).animate({opacity:1,marginTop:"20px"},200,"linear");$(".flappy-buttons").delay(400).animate({opacity:1},200,"linear");if(FinalResult>=max&&FinalResult>0){$("<b>new</b>").prependTo(".flappy-best-result")}$(".flappy, .flappy-line").css({"animation-play-state":"paused","background-position":"0px 0px"});$(".flappy-restart").attr("tabindex","0").focus();$(".flappy-restart").bind("keydown",function(e){if(e.keyCode==13){$(".flappy-play").remove();$("*").stop();N()}});$(".flappy-restart").click(function(){$(".flappy-play").remove();$("*").stop();N()})}function k(){function e(){$(".flappy").stop();$(".flappy-animation").addClass("flappy-up").removeClass("flappy-down");$(".flappy").animate({top:"-="+70},120,"linear",function(){n.trigger("MouseUp")})}w(r);x();$(".flappy").css("animation-play-state","paused");$(".flappy").animate({top:n.height()-($(".flappy").height()+$(".flappy-line").height())},500*2,"linear",function(){E();return false});n.mousedown(function(t){t.preventDefault();e()});n.bind("keydown",function(t){t.preventDefault();if(t.keyCode==38||t.keyCode==87||t.keyCode==32){e()}});n.on("MouseUp",function(e){e.preventDefault();T();$(".flappy").stop();$(".flappy-animation").removeClass("flappy-up").addClass("flappy-down");animationspeed=(h-v)*2.8;$(".flappy").animate({top:n.height()-($(".flappy").height()+$(".flappy-line").height())},animationspeed,"linear",function(){C()})})}var t=$.extend({total:5,step:300,innerColumn:170},e);var n=this;var r=t.total;var i=t.step;var s=t.innerColumn;var o=[];var u=["flappy","flappy-b","flappy-g"];var a=u[Math.floor(Math.random()*u.length)];var f=["city","space","sea","cemetery","swamp","sea-sunset","sea-night"];var l=f[Math.floor(Math.random()*f.length)];var c=$(".flappy").css("top");var h=n.height()-$(".flappy-line").height();var p=true;var d=0;var v=n.height()/2;var m=0;if(r<n.width()/i){r=n.width()/i+1}$(n).css({background:"transparent url(http://troevkube.ru/flappy/flappy-assets/image/background-"+l+".png) 0 0 no-repeat","background-size":"cover",overflow:"hidden",cursor:"pointer","user-select":"none"});$(window).resize(function(){location.reload()});N()}